{"name":"RepData_PeerAssessment2","tagline":"","body":"---\r\ntitle: \"NOAA Storm Events Most Harmful to Economic and Personal Health\"\r\nauthor: \"Eric Bruce\"\r\ndate: \"October 22, 2015\"\r\noutput:\r\n  html_document:\r\n     toc: true\r\n     theme: united\r\n---\r\n\r\n## Synopsis\r\n\r\nThe data analysis explores the NOAA Storm Database to answer the following questions:\r\n\r\n1. Across the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?\r\n\r\n2. Across the United States, which types of events have the greatest economic consequences?\r\n\r\nThe data was downloaded as a zip file and then pre-processed. The events in the database start in the year 1950 and end in November 2011. The analysis used events from 1996 - 2011 because it was considered more complete and most useful to answer the questions posed. The results of the analysis are presented in two geometric bar charts.  \r\n\r\n## Data Processing\r\nThe following package libraries were used:\r\n\r\n```{r}\r\nlibrary(data.table)\r\nlibrary(ggplot2)\r\nlibrary(scales)\r\n```\r\n\r\nThe file was downloaded, unzipped and a dataframe 'storm.df' was built.\r\n```{r}\r\nfileUrl <- \"https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2\"\r\nif (!file.exists(\"./storm.csv.bz2\")){\r\n  download.file(fileUrl,destfile=\"./storm.csv.bz2\")\r\n}\r\n# Below code is Linux only\r\nstorm.df = fread(sprintf(\"bzcat %s | tr -d '\\\\000'\", \"./storm.csv.bz2\"))\r\n```\r\n\r\nThe file structure was reviewed and decisions were made as to which columns were useful for answering the questions. A second dataframe 'analysis.df' was built.\r\n```{r}\r\nstr(storm.df)\r\n\r\nkeeps = c(\"BGN_DATE\", \r\n          \"STATE\", \r\n          \"COUNTY\", \r\n          \"EVTYPE\", \r\n          \"F\", \r\n          \"MAG\", \r\n          \"FATALITIES\", \r\n          \"INJURIES\", \r\n          \"PROPDMG\",\r\n          \"PROPDMGEXP\", \r\n          \"CROPDMG\", \r\n          \"CROPDMGEXP\"\r\n           )\r\nanalysis.df = subset(storm.df, select = keeps)\r\n\r\n```\r\n\r\nThe dates were converted to support further exploratory data analysis.\r\n```{r}\r\nanalysis.df$BGN_DATE = gsub(\"0:00:00\", \"\", analysis.df$BGN_DATE, fixed = TRUE)\r\nanalysis.df$DATE = as.Date(analysis.df$BGN_DATE, \"%m/%d/%Y\")\r\nanalysis.df$YEAR = as.POSIXlt(analysis.df$DATE)$year+1900 \r\n```\r\n\r\nThe property and crop damages were converted to USD. Total Cash Damages and Total Population Health figures were calculated.\r\n```{r}\r\n# Hundred (H), Thousand (K), Million (M), Billion (B)\r\nConvertDamages <- function(d,k) {\r\n    ifelse(k == 'H', 100 * d, \r\n    ifelse(k == 'K', 1000 * d, \r\n    ifelse(k == 'K', 1000 * d, \r\n    ifelse(k == 'M', 1000000 * d, \r\n    ifelse(k == 'B', 1000000000 * d, 0))))) \r\n  }\r\n\r\nanalysis.df$PROPCASH = ConvertDamages(analysis.df$PROPDMG, analysis.df$PROPDMGEXP) \r\nanalysis.df$CROPCASH = ConvertDamages(analysis.df$CROPDMG, analysis.df$CROPDMGEXP) \r\nanalysis.df$TOTCASH = analysis.df$PROPCASH + analysis.df$CROPCASH\r\nanalysis.df$TOTNEGHEALTH = analysis.df$FATALITIES+analysis.df$INJURIES\r\n```\r\n\r\nAdditional housecleaning was performed to get rid of unnecessary columns.\r\n```{r}\r\ndeletes = c(\"BGN_DATE\", \r\n          \"PROPDMG\",\r\n          \"PROPDMGEXP\", \r\n          \"CROPDMG\", \r\n          \"CROPDMGEXP\"\r\n)\r\n\r\nset(analysis.df, j = deletes, value = NULL)\r\n```\r\n\r\nNot all storm events were part of the database prior to 1996. From 1950 through 1954, only tornado events were recorded. From 1955 through 1992, only tornado, thunderstorm wind and hail events were keyed from the paper publications into digital data. From 1993 to 1995, only tornado, thunderstorm wind and hail events have been extracted from the Unformatted Text Files. Therefore it was deemed best to use data only from 1996 - 2011 to answer the questions. A dataframe 'analysis.since1996.df' was built based on the [NOAA Storm Events Details documentation](http://www.ncdc.noaa.gov/stormevents/details.jsp). \r\n```{r}\r\nanalysis.since1996.df = subset(analysis.df, YEAR > 1995)\r\n```\r\n\r\nFrom 1996 to present, 48 event types are recorded as defined in NWS Directive 10-1605. \r\n```{r}\r\nevtypes = data.frame(unique((analysis.since1996.df$EVTYPE)))\r\n```\r\n\r\nThere were `r nrow(evtypes)` unique event types in the dataframe 'analysis.since1996.df' so it was necessary to examine these and map the extras to the 48 event types as defined in NWS Directive 10-1605. The first step to make the data mapping as efficient as possible was to subset the dataframe to include only those EVTYPES that were candidates to be the most harmful from an economic or public health standpoint. \r\n```{r}\r\nanalysis.since1996.df = subset(analysis.since1996.df, TOTCASH > 100 | TOTNEGHEALTH > 1)\r\n```\r\n\r\nAn initial exploratory data analysis was performed to identify the EVTYPE candidates.\r\n```{r}\r\nx = tapply(analysis.since1996.df$TOTNEGHEALTH, analysis.since1996.df$EVTYPE, sum, na.rm=T) \r\npubhealth.plot = data.frame(EVTYPE = names(x), INJFATAL=x)\r\n\r\nx = tapply(analysis.since1996.df$TOTCASH, analysis.since1996.df$EVTYPE, sum, na.rm=T) \r\neconomic.plot = data.frame(EVTYPE = names(x), CASH=x)\r\n```\r\n\r\nThat analysis showed that some minimal data mapping would enable the questions to be answered.\r\n```{r}\r\ntstrm = c(\"TSTM WIND\", \r\n          \"THUNDERSTORM WIND\",\r\n          \"THUNDERSTORM WIND/HAIL\",\r\n          \"TSTM WIND/HAIL\")\r\n\r\nfog = c(\"FOG\", \"DENSE FOG\")\r\n\r\nhcane = c(\"HURRICANE\", \r\n          \"HURRICANE/TYPHOON\",\r\n          \"TYPHOON\")\r\n\r\ncflood = c(\"COASTAL FLOODING\", \r\n           \"COASTAL FLOOD\", \r\n           \"EROSION/CSTL FLOOD\",\r\n           \"COASTAL FLOODING/EROSION\")\r\n\r\ncold = c(\"UNSEASONABLE COLD\", \"COLD/WIND CHILL\")\r\n\r\nsurge = c(\"STORM SURGE\", \"STORM SURGE/TIDE\")\r\n\r\nanalysis.since1996.df$EVTYPE =  ifelse(analysis.since1996.df$EVTYPE %in% tstrm, \"THUNDERSTORM WIND\", \r\n                                       ifelse(analysis.since1996.df$EVTYPE %in% fog, \"DENSE FOG\", \r\n                                              ifelse(analysis.since1996.df$EVTYPE %in% hcane, \"HURRICANE/TYPHOON\", \r\n                                                     ifelse(analysis.since1996.df$EVTYPE %in% cflood, \"COASTAL FLOOD\", \r\n                                                            ifelse(analysis.since1996.df$EVTYPE %in% cold, \"COLD/WIND CHILL\", \r\n                                                                   ifelse(analysis.since1996.df$EVTYPE %in% surge, \"STORM SURGE/TIDE\", analysis.since1996.df$EVTYPE)))))) \r\n\r\n```\r\n\r\nA second and final exploratory data analysis with the newly mapped data was performed. Two dataframes 'pubhealth.top10pct' and 'economic.top10pct' contain the top 10% most harmful event types to public health and economic property and crop loss. \r\n```{r}\r\nx = tapply(analysis.since1996.df$TOTNEGHEALTH, analysis.since1996.df$EVTYPE, sum, na.rm=T) \r\ny = tapply(analysis.since1996.df$FATALITIES, analysis.since1996.df$EVTYPE, sum, na.rm=T) \r\nz = tapply(analysis.since1996.df$INJURIES, analysis.since1996.df$EVTYPE, sum, na.rm=T) \r\npubhealth.plot = data.frame(EVTYPE = names(x), INJFATAL=x, FATAL = y, INJURY = z)\r\npubhealth.top10pct = head(pubhealth.plot[order(pubhealth.plot$INJFATAL,decreasing=T),],.10*nrow(pubhealth.plot))\r\n\r\nx = tapply(analysis.since1996.df$TOTCASH, analysis.since1996.df$EVTYPE, sum, na.rm=T) \r\ny = tapply(analysis.since1996.df$PROPCASH, analysis.since1996.df$EVTYPE, sum, na.rm=T) \r\nz = tapply(analysis.since1996.df$CROPCASH, analysis.since1996.df$EVTYPE, sum, na.rm=T) \r\neconomic.plot = data.frame(EVTYPE = names(x), CASH=x/1000000000, PROPERTY = y/1000000000, CROP = z/1000000000 )\r\neconomic.top10pct = head(economic.plot[order(economic.plot$CASH,decreasing=T),],.10*nrow(economic.plot))\r\n```\r\n\r\nBoth questions can now be answered.\r\n\r\n## Results\r\n####1. Across the United States, the events most harmful with respect to population health are shown in the below graph.\r\n```{r}\r\np1 = ggplot(pubhealth.top10pct, aes(x=reorder(EVTYPE, INJFATAL), y=INJFATAL)) + geom_bar(stat=\"identity\") + coord_flip()\r\n# Add plot title & labels\r\np1 = p1 + ggtitle(\"Most Harmful Events - Population Health 1996 - 2011\") + \r\n    xlab(\"\") +\r\n    ylab(\"Number of Injuries and Fatalities\")\r\n# White background and black grid lines\r\np1 <- p1 + theme_bw()\r\nprint(p1)  \r\n```\r\n\r\n####2. Across the United States, the events with the greatest economic consequences are shown in the below graph.\r\n```{r}\r\np2 = ggplot(economic.top10pct, aes(x=reorder(EVTYPE, CASH), y=CASH)) + geom_bar(stat=\"identity\") + coord_flip()\r\n# Add plot title & labels\r\np2 = p2 + ggtitle(\"Most Harmful Events - Property Damage 1996 - 2011\") + \r\n  xlab(\"\") +\r\n  ylab(\"Property and Crop Damage - $ Billions\")\r\np2 = p2 + scale_y_continuous(labels = dollar)\r\n# White background and black grid lines\r\np2 = p2 + theme_bw()\r\nprint(p2)  \r\n```\r\n\r\nNote that the dollar figures were not modified for inflation nor was a robust data mapping performed. This was not entirely necessary for the intended use of the analysis - preparing for severe weather events and prioritizing resources for different types of events.  This analysis could also easily be used to drill down to local state or municipalities if required.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}